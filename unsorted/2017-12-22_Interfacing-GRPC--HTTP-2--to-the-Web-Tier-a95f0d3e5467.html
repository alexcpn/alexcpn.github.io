<!DOCTYPE html><html><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"><title>Interfacing GRPC (HTTP/2) to the Web Tier</title><style>
      * {
        font-family: Georgia, Cambria, "Times New Roman", Times, serif;
      }
      html, body {
        margin: 0;
        padding: 0;
      }
      h1 {
        font-size: 50px;
        margin-bottom: 17px;
        color: #333;
      }
      h2 {
        font-size: 24px;
        line-height: 1.6;
        margin: 30px 0 0 0;
        margin-bottom: 18px;
        margin-top: 33px;
        color: #333;
      }
      h3 {
        font-size: 30px;
        margin: 10px 0 20px 0;
        color: #333;
      }
      header {
        width: 640px;
        margin: auto;
      }
      section {
        width: 640px;
        margin: auto;
      }
      section p {
        margin-bottom: 27px;
        font-size: 20px;
        line-height: 1.6;
        color: #333;
      }
      section img {
        max-width: 640px;
      }
      footer {
        padding: 0 20px;
        margin: 50px 0;
        text-align: center;
        font-size: 12px;
      }
      .aspectRatioPlaceholder {
        max-width: auto !important;
        max-height: auto !important;
      }
      .aspectRatioPlaceholder-fill {
        padding-bottom: 0 !important;
      }
      header,
      section[data-field=subtitle],
      section[data-field=description] {
        display: none;
      }
      </style></head><body><article class="h-entry">
<header>
<h1 class="p-name">Interfacing GRPC (HTTP/2) to the Web Tier</h1>
</header>
<section data-field="subtitle" class="p-summary">
Update (Aug 2018)- There is a better option than this ; there is a GRPC-Web project from Google; Please check this first…
</section>
<section data-field="body" class="e-content">
<section name="e535" class="section section--body section--first"><div class="section-divider"><hr class="section-divider"></div><div class="section-content"><div class="section-inner sectionLayout--insetColumn"><h3 name="b495" id="b495" class="graf graf--h3 graf--leading graf--title">Interfacing GRPC (HTTP/2) to the Web Tier</h3><p name="4596" id="4596" class="graf graf--p graf-after--h3">Update (Aug 2018)- There is a better option than this ; there is a GRPC-Web project from Google; Please check this first <a href="https://medium.com/@alexcpn/interface-grpc-with-web-using-grpc-web-and-envoy-possibly-the-best-way-forward-3ae9671af67" data-href="https://medium.com/@alexcpn/interface-grpc-with-web-using-grpc-web-and-envoy-possibly-the-best-way-forward-3ae9671af67" class="markup--anchor markup--p-anchor" rel="nofollow" target="_blank">https://medium.com/@alexcpn/interface-grpc-with-web-using-grpc-web-and-envoy-possibly-the-best-way-forward-3ae9671af67</a></p><p name="6bf7" id="6bf7" class="graf graf--p graf-after--p">There are two options in general for making your GRPC service accessible to services like browser side JavaScript that consume REST, or even API gateways.</p><h4 name="2918" id="2918" class="graf graf--h4 graf-after--p">Option 1</h4><p name="67eb" id="67eb" class="graf graf--p graf-after--h4">For GUI consumption,a better approach would be to have something like a Facade service written in the like <em class="markup--em markup--p-em">of Backend for Front end </em>pattern that mediates between grpc and web browser using Node.js based technology. We will see this later.</p><p name="6554" id="6554" class="graf graf--p graf-after--p">The advantage of this approach is that, with micro services there would be too much logic to orchestrate between services and an orchestration layer or service is going to come up somehow. Better to have this at the beginning and using TypeScript and Node.js technology this will be finally in the realm of front end developers.</p><p name="c897" id="c897" class="graf graf--p graf-after--p">They could write Typescript GRPC client and expose their own custom REST API for the GUI part, dealing with the changes and new versions of the other services in their own timelines. In Node.JS a web server serving this REST could be run for the front end.</p><h4 name="f4be" id="f4be" class="graf graf--h4 graf-after--p">Option 2</h4><p name="7f60" id="7f60" class="graf graf--p graf-after--h4">There is another way; a more automatic way of exposing a HTTP server with the GRPC interface directly via the <a href="https://github.com/improbable-eng/grpc-web" data-href="https://github.com/improbable-eng/grpc-web" class="markup--anchor markup--p-anchor" rel="noopener" target="_blank">grpc -web</a> project, which is <a href="https://improbable.io/games/blog/grpc-web-moving-past-restjson-towards-type-safe-web-apis" data-href="https://improbable.io/games/blog/grpc-web-moving-past-restjson-towards-type-safe-web-apis" class="markup--anchor markup--p-anchor" rel="noopener" target="_blank">more elegant</a> than the <a href="https://github.com/grpc-ecosystem/grpc-gateway" data-href="https://github.com/grpc-ecosystem/grpc-gateway" class="markup--anchor markup--p-anchor" rel="noopener" target="_blank">grpc gateway</a> way; thanks to the team at<a href="https://improbable.io/" data-href="https://improbable.io/" class="markup--anchor markup--p-anchor" rel="noopener" target="_blank"> Improbable OS</a> for open sourcing this.</p><p name="e284" id="e284" class="graf graf--p graf-after--p">Let us start from the beginning;</p><p name="a8a0" id="a8a0" class="graf graf--p graf-after--p"><strong class="markup--strong markup--p-strong"><em class="markup--em markup--p-em">Define a proto file for your service.</em></strong></p><p name="659c" id="659c" class="graf graf--p graf-after--p">Let us take a very simple one,an Echo service, <em class="markup--em markup--p-em">your_service.proto</em></p><pre name="b482" id="b482" class="graf graf--pre graf-after--p">syntax = &quot;proto3&quot;;<br>package example;<br>message StringMessage {<br>string value = 1;<br>}<br>service YourService {<br>rpc Echo(StringMessage) returns (StringMessage) {<br>}<br>}</pre><p name="be27" id="be27" class="graf graf--p graf-after--pre">Now there are two options you can take;aren’t we spoiled for choices …</p><p name="b0f3" id="b0f3" class="graf graf--p graf-after--p"><strong class="markup--strong markup--p-strong">There are two choices with grpc-web as well</strong></p><p name="c449" id="c449" class="graf graf--p graf-after--p"><em class="markup--em markup--p-em">Option 1 : Implement the service in Go programming language.</em></p><p name="d592" id="d592" class="graf graf--p graf-after--p">If you do this, then you can use <a href="https://github.com/improbable-eng/grpc-web/tree/master/go/grpcweb" data-href="https://github.com/improbable-eng/grpc-web/tree/master/go/grpcweb" class="markup--anchor markup--p-anchor" rel="noopener" target="_blank"><strong class="markup--strong markup--p-strong"><em class="markup--em markup--p-em">grpc-web</em></strong></a> Go module — to wrap the service and expose it as HTTP/1.1.</p><p name="3653" id="3653" class="graf graf--p graf-after--p">Let us do that;</p><p name="a6db" id="a6db" class="graf graf--p graf-after--p">Step 1: Generate the Grpc and protobuffer stubs from proto; For this (or any Grpc project) you need to install <a href="https://github.com/google/protobuf" data-href="https://github.com/google/protobuf" class="markup--anchor markup--p-anchor" rel="noopener" target="_blank">ProtoBuffer</a>. Note that for grpc we need proto3 support; I used a Linux machine for development and had installed Protoc version 3 in it by compiling from sources as described <a href="https://github.com/google/protobuf/tree/master/src" data-href="https://github.com/google/protobuf/tree/master/src" class="markup--anchor markup--p-anchor" rel="noopener" target="_blank">here</a>.</p><pre name="b762" id="b762" class="graf graf--pre graf-after--p">#protoc --version<br>libprotoc 3.2.0</pre><p name="7cd0" id="7cd0" class="graf graf--p graf-after--pre">Now create a simple folder structure for your project; I named the root folder <em class="markup--em markup--p-em">test_proto </em>and created a folder <em class="markup--em markup--p-em">proto</em> to keep the proto file and also the generated stubs. Now to generate the stubs</p><pre name="c48e" id="c48e" class="graf graf--pre graf-after--p">protoc -I proto/ proto/your_service.proto --go_out=plugins=grpc:proto</pre><p name="575f" id="575f" class="graf graf--p graf-after--pre">This will generate a <em class="markup--em markup--p-em">your_service.pb.go</em></p><p name="bd6c" id="bd6c" class="graf graf--p graf-after--p">Now let us implement a very simple Go Server. I used VSCode and added Go language support. Since the source is simple I will list it and explain later. If you are starting with Go, then it is a language similar to C, with a s<a href="https://tip.golang.org/doc/faq#unused_variables_and_imports" data-href="https://tip.golang.org/doc/faq#unused_variables_and_imports" class="markup--anchor markup--p-anchor" rel="noopener" target="_blank">trict import semantics</a> (for faster builds than C/C++), simple and effective GC, pointers and interfaces/class as type; Some cons could be l<a href="https://blog.gopheracademy.com/advent-2016/saga-go-dependency-management/" data-href="https://blog.gopheracademy.com/advent-2016/saga-go-dependency-management/" class="markup--anchor markup--p-anchor" rel="noopener" target="_blank">ack of a good dependency management</a>, that is versioning concept of external libs are tied to latest of Git HEAD currently; and of course , new languages may lack the highly tuned libraries that are built over years examples the ones for C/C++ which are easily usable in Python, or the ones for Java that are easily usable for Scala etc. The main problems that Go was designed to solve are listed <a href="https://talks.golang.org/2012/splash.article" data-href="https://talks.golang.org/2012/splash.article" class="markup--anchor markup--p-anchor" rel="noopener" target="_blank">here</a>.</p><p name="73a3" id="73a3" class="graf graf--p graf-after--p">Here is a simple Go GRPC service for the proto that exposes HTTP/2. This link here could be helpful <a href="http://www.grpc.io/docs/tutorials/basic/go.html" data-href="http://www.grpc.io/docs/tutorials/basic/go.html" class="markup--anchor markup--p-anchor" rel="nofollow noopener noopener noopener" target="_blank">http://www.grpc.io/docs/tutorials/basic/go.html</a></p><pre name="9db8" id="9db8" class="graf graf--pre graf-after--p">go get -u github.com/grpc-ecosystem/grpc-gateway/protoc-gen-grpc-gateway<br>go get -u github.com/golang/protobuf/protoc-gen-go</pre><pre name="9612" id="9612" class="graf graf--pre graf-after--pre">package main</pre><pre name="67d3" id="67d3" class="graf graf--pre graf-after--pre">import (<br> &quot;log&quot;<br> &quot;net&quot;<br> pb &quot;test_proto/proto&quot;</pre><pre name="28a9" id="28a9" class="graf graf--pre graf-after--pre">&quot;golang.org/x/net/context&quot;<br> &quot;google.golang.org/grpc&quot;<br> &quot;google.golang.org/grpc/reflection&quot;<br>)</pre><pre name="5de4" id="5de4" class="graf graf--pre graf-after--pre">const port = &quot;:7001&quot;</pre><pre name="1778" id="1778" class="graf graf--pre graf-after--pre">type server struct{}</pre><pre name="8820" id="8820" class="graf graf--pre graf-after--pre">func (s *server) Echo(ctx context.Context, in *pb.StringMessage) (*pb.StringMessage, error) {<br> log.Println(&quot;Got a request&quot;)<br> return &amp;pb.StringMessage{Value: &quot;Hello From a GRPC Method (GRPC WEB Go Server Served) &quot; + in.Value}, nil<br>}</pre><pre name="d4c3" id="d4c3" class="graf graf--pre graf-after--pre">func main() {</pre><pre name="aa61" id="aa61" class="graf graf--pre graf-after--pre">log.Println(&quot;Hello Go&quot;)<br> lis, err := net.Listen(&quot;tcp&quot;, port)<br> if err != nil {<br>  log.Fatalf(&quot;failed to listen: %v&quot;, err)<br> }<br> s := grpc.NewServer()</pre><pre name="bd44" id="bd44" class="graf graf--pre graf-after--pre">reflection.Register(s)<br> if err := s.Serve(lis); err != nil {<br>  log.Fatalf(&quot;failed to serve: %v&quot;, err)<br> }</pre><pre name="2de2" id="2de2" class="graf graf--pre graf-after--pre">}</pre><p name="76c9" id="76c9" class="graf graf--p graf-after--pre">Now let us transform the main part, wrap it in grpc-web so that it server HTTP/2</p><pre name="f27e" id="f27e" class="graf graf--pre graf-after--p">go get -u github.com/improbable-eng/grpc-web/go/grpcweb</pre><pre name="92c8" id="92c8" class="graf graf--pre graf-after--pre">import (<br> &quot;fmt&quot;<br> &quot;log&quot;<br> &quot;net/http&quot;<br> pb &quot;test_proto/proto&quot;</pre><pre name="0df7" id="0df7" class="graf graf--pre graf-after--pre"><strong class="markup--strong markup--pre-strong">&quot;github.com/improbable-eng/grpc-web/go/grpcweb&quot;</strong><br> &quot;golang.org/x/net/context&quot;<br> &quot;google.golang.org/grpc&quot;<br> &quot;google.golang.org/grpc/grpclog&quot;<br>)<br>const port = &quot;:7001&quot;</pre><pre name="06ab" id="06ab" class="graf graf--pre graf-after--pre">type server struct{}</pre><pre name="6a1f" id="6a1f" class="graf graf--pre graf-after--pre">func (s *server) Echo(ctx context.Context, in *pb.StringMessage) (*pb.StringMessage, error) {<br> log.Println(&quot;Got a request&quot;)<br> return &amp;pb.StringMessage{Value: &quot;Hello From a GRPC Method (GRPC WEB Go Server Served) &quot; + in.Value}, nil<br>}</pre><pre name="d99c" id="d99c" class="graf graf--pre graf-after--pre">func main() {</pre><pre name="88de" id="88de" class="graf graf--pre graf-after--pre">log.Println(&quot;Hello Go&quot;)</pre><pre name="4f8a" id="4f8a" class="graf graf--pre graf-after--pre">s := grpc.NewServer()<br> pb.RegisterYourServiceServer(s, &amp;server{})<br> // wrapping in GRPC WEB<br> <strong class="markup--strong markup--pre-strong">wrappedServer := grpcweb.WrapServer(s)<br> handler := func(resp http.ResponseWriter, req *http.Request) {<br>  wrappedServer.ServeHTTP(resp, req)</strong></pre><pre name="553c" id="553c" class="graf graf--pre graf-after--pre"><strong class="markup--strong markup--pre-strong">}<br> httpServer := http.Server{<br>  Addr:    fmt.Sprintf(&quot;:%d&quot;, 8001),<br>  Handler: http.HandlerFunc(handler),<br> }</strong></pre><pre name="4802" id="4802" class="graf graf--pre graf-after--pre">if err := httpServer.ListenAndServe(); err != nil {<br>  grpclog.Fatalf(&quot;failed starting http server: %v&quot;, err)<br> }</pre><pre name="334a" id="334a" class="graf graf--pre graf-after--pre">}</pre><p name="812c" id="812c" class="graf graf--p graf-after--pre">Run your Server (for HTTPS please see <a href="https://github.com/improbable-eng/grpc-web/tree/master/go/grpcweb" data-href="https://github.com/improbable-eng/grpc-web/tree/master/go/grpcweb" class="markup--anchor markup--p-anchor" rel="nofollow noopener noopener noopener" target="_blank">https://github.com/improbable-eng/grpc-web/tree/master/go/grpcweb</a>)</p><pre name="526f" id="526f" class="graf graf--pre graf-after--p graf--trailing">go run test_server.go<br>2017/06/08 15:52:34 Hello Go</pre></div></div></section><section name="0390" class="section section--body"><div class="section-divider"><hr class="section-divider"></div><div class="section-content"><div class="section-inner sectionLayout--insetColumn"><p name="3bde" id="3bde" class="graf graf--p graf--leading">Now Let us Have a Client for this Service; And for that we use TypeScript with Node.JS and grpc_web Typesript Node.JS modules . <a href="https://www.typescriptlang.org/docs/handbook/typescript-in-5-minutes.html" data-href="https://www.typescriptlang.org/docs/handbook/typescript-in-5-minutes.html" class="markup--anchor markup--p-anchor" rel="noopener" target="_blank">TypeScript</a> is a super-set of JavaScript offering static typing and <a href="https://www.reddit.com/r/programming/comments/64e6x7/typescript_got_approved_as_internal_development/" data-href="https://www.reddit.com/r/programming/comments/64e6x7/typescript_got_approved_as_internal_development/" class="markup--anchor markup--p-anchor" rel="noopener" target="_blank">well adopted</a>; and <a href="https://basarat.gitbooks.io/typescript/docs/quick/nodejs.html" data-href="https://basarat.gitbooks.io/typescript/docs/quick/nodejs.html" class="markup--anchor markup--p-anchor" rel="noopener" target="_blank">TypeScript with Node.JS</a> is a good combination for the<a href="https://www.thoughtworks.com/pt/insights/blog/bff-soundcloud" data-href="https://www.thoughtworks.com/pt/insights/blog/bff-soundcloud" class="markup--anchor markup--p-anchor" rel="noopener" target="_blank"> Back End For Front End </a>Pattern (we will see this option later). From the your_service.proto file, we need to create the TypeScript GRPC Stubs. You can follow the instructions here <a href="https://github.com/improbable-eng/ts-protoc-gen" data-href="https://github.com/improbable-eng/ts-protoc-gen" class="markup--anchor markup--p-anchor" rel="nofollow noopener noopener noopener" target="_blank">https://github.com/improbable-eng/ts-protoc-gen</a></p><pre name="38ad" id="38ad" class="graf graf--pre graf-after--p">npm install ts-protoc-gen</pre><p name="be4c" id="be4c" class="graf graf--p graf-after--pre">and generate the stubs</p><pre name="be09" id="be09" class="graf graf--pre graf-after--p">protoc --plugin=protoc-gen-ts=./node_modules/.bin/protoc-gen-ts --js_out=import_style=commonjs,binary:gene<br>rated --ts_out=service=true:generated -I /home/alex/go-path/src/test_proto/proto/ /home/alex/go-path/src/test_pro<br>to/proto/your_service.proto</pre><p name="fa89" id="fa89" class="graf graf--p graf-after--pre">Note that node.js packages most dependencies to ./node_moudles folder; For that you need to either install it yourself like</p><pre name="aaf0" id="aaf0" class="graf graf--pre graf-after--p">npm install -g typescript<br> npm install <a href="http://twitter.com/types/node" data-href="http://twitter.com/types/node" class="markup--anchor markup--pre-anchor" title="Twitter profile for @types/node" rel="noopener" target="_blank">@types/node</a> --save-dev<br> npm install ts-protoc-gen <em class="markup--em markup--pre-em">--&gt; from grpc-web</em><br> npm install grpc-web-client<em class="markup--em markup--pre-em"> --&gt; from grpc-web</em><br> npm install google-protobuf --&gt; <em class="markup--em markup--pre-em">had some problems with NPM</em><br> npm install --save-dev typescript gulp gulp-typescript --&gt; for gulp<br> npm install --save-dev babelify</pre><p name="8354" id="8354" class="graf graf--p graf-after--pre">or better add the dependencies in Project <em class="markup--em markup--p-em">package.json</em> and use npm install</p><pre name="52c0" id="52c0" class="graf graf--pre graf-after--p">&quot;devDependencies&quot;: {<br>    &quot;<a href="http://twitter.com/types/node" data-href="http://twitter.com/types/node" class="markup--anchor markup--pre-anchor" title="Twitter profile for @types/node" rel="noopener" target="_blank">@types/node</a>&quot;: &quot;^7.0.27&quot;,<br>    &quot;babelify&quot;: &quot;^7.3.0&quot;,<br>    &quot;browserify&quot;: &quot;^14.4.0&quot;,<br>    &quot;gulp&quot;: &quot;^3.9.1&quot;,<br>    &quot;gulp-typescript&quot;: &quot;^3.1.7&quot;,<br>    &quot;tsify&quot;: &quot;^3.0.1&quot;,<br>    &quot;typescript&quot;: &quot;^2.3.4&quot;,<br>    &quot;vinyl-source-stream&quot;: &quot;^1.1.0&quot;<br>  },<br>  &quot;dependencies&quot;: {<br>    &quot;<a href="http://twitter.com/types/google-protobuf" data-href="http://twitter.com/types/google-protobuf" class="markup--anchor markup--pre-anchor" title="Twitter profile for @types/google-protobuf" rel="noopener" target="_blank">@types/google-protobuf</a>&quot;: &quot;^3.2.6&quot;,<br>    &quot;google-protobuf&quot;: &quot;^3.2.5&quot;,<br>    &quot;typescript&quot;: &quot;^2.3.4&quot;<br>  }</pre><p name="b947" id="b947" class="graf graf--p graf-after--pre">If you are really wondering what Gulp is or why I added it, better to have a <a href="https://www.typescriptlang.org/docs/handbook/gulp.html" data-href="https://www.typescriptlang.org/docs/handbook/gulp.html" class="markup--anchor markup--p-anchor" rel="noopener" target="_blank">short read</a> of Gulp; basically it is something like make.</p><p name="d5aa" id="d5aa" class="graf graf--p graf-after--p">The TypeScript has to be compiled to JavaScript so that it can be included in HTML and called from HTML; Instead of using raw <em class="markup--em markup--p-em">tsc (TypeScript Compiler) </em>to compile to JavaScript, if you have multiple JS modules, using <a href="http://browserify.org/" data-href="http://browserify.org/" class="markup--anchor markup--p-anchor" rel="noopener" target="_blank">browserify</a> you can create a single <em class="markup--em markup--p-em">bundle.js</em> that you can use in HTML code. Gulp with the associated gulpfile.js takes care of automating the build flow.</p><p name="3844" id="3844" class="graf graf--p graf-after--p">Now let us create a simple node.js project and add the main Typescript file grpc_client.ts which calls the grpc-web wrapped service. I will put the code in git; But here is the gist</p><pre name="690b" id="690b" class="graf graf--pre graf-after--p">// A TypeScipt. WebClient for GRPC<br>// Based on <a href="https://github.com/improbable-eng/grpc-web/blob/master/example/ts/src/index.ts" data-href="https://github.com/improbable-eng/grpc-web/blob/master/example/ts/src/index.ts" class="markup--anchor markup--pre-anchor" rel="nofollow noopener noopener noopener" target="_blank">https://github.com/improbable-eng/grpc-web/blob/master/example/ts/src/index.ts</a></pre><pre name="1f7c" id="1f7c" class="graf graf--pre graf-after--pre">import { grpc, BrowserHeaders } from &quot;grpc-web-client&quot;;<br>import { YourService } from &quot;../generated/your_service_pb_service&quot;<br>import {StringMessage} from &quot;../generated/your_service_pb&quot;</pre><pre name="d46e" id="d46e" class="graf graf--pre graf-after--pre">function getResponse(){<br>        <br>    const stringMessage = new StringMessage();<br>    stringMessage.setValue(&quot;hello&quot;);<br>    <br>       <strong class="markup--strong markup--pre-strong">grpc.invoke(YourService.Echo</strong> ,{<br>        request :stringMessage,<br>        host : &quot;<a href="http://localhost:8001" data-href="http://localhost:8001" class="markup--anchor markup--pre-anchor" rel="nofollow" target="_blank">http://localhost:8001</a>&quot;,<br>        onHeaders: (headers: BrowserHeaders) =&gt; {<br>            console.log(&quot;Echo.onHeaders&quot;, headers);<br>        },<br>        <strong class="markup--strong markup--pre-strong">onMessage</strong>: (message: StringMessage) =&gt; {<br>            console.log(&quot;Echo.onMessage&quot;, message.toObject());<br>            const elt = <strong class="markup--strong markup--pre-strong">document.getElementById(&quot;greeting&quot;);</strong><br>            elt.innerText = message.toString();<br>        },<br>        onEnd: (code: grpc.Code, msg: string, trailers: BrowserHeaders) =&gt; {<br>            console.log(&quot;Echo.onEnd&quot;, code, msg, trailers);<br>        }<br>    })<br>    <br>}</pre><pre name="5c66" id="5c66" class="graf graf--pre graf-after--pre">getResponse();</pre><p name="10eb" id="10eb" class="graf graf--p graf-after--pre">now , write up a small html page that includes and invokes the JS</p><pre name="5fdb" id="5fdb" class="graf graf--pre graf-after--p">&lt;!DOCTYPE html&gt;<br>&lt;html&gt;</pre><pre name="12f4" id="12f4" class="graf graf--pre graf-after--pre">&lt;head&gt;<br>    &lt;meta charset=&quot;UTF-8&quot; /&gt;<br>    &lt;title&gt;Hello GRPC Web!&lt;/title&gt;<br>&lt;/head&gt;</pre><pre name="e47c" id="e47c" class="graf graf--pre graf-after--pre">&lt;body&gt;<br>    &lt;p id=&quot;<strong class="markup--strong markup--pre-strong">greeting</strong>&quot;&gt;Loading ...&lt;/p&gt;<br>    <strong class="markup--strong markup--pre-strong">&lt;script src=&quot;bundle.js&quot;&gt;&lt;/script&gt;</strong><br>&lt;/body&gt;</pre><pre name="99f0" id="99f0" class="graf graf--pre graf-after--pre">&lt;/html&gt;</pre><p name="f2f3" id="f2f3" class="graf graf--p graf-after--pre">run gulp to create the bundle.js</p><pre name="2479" id="2479" class="graf graf--pre graf-after--p">gulp</pre><p name="e2c5" id="e2c5" class="graf graf--p graf-after--pre">Open the index.html in the <em class="markup--em markup--p-em">dist folder </em>that gulp has put</p><p name="3a0f" id="3a0f" class="graf graf--p graf-after--p">You should see</p><figure name="f517" id="f517" class="graf graf--figure graf-after--p"><div class="aspectRatioPlaceholder is-locked" style="max-width: 611px; max-height: 120px;"><div class="aspectRatioPlaceholder-fill" style="padding-bottom: 19.6%;"></div><img class="graf-image" data-image-id="1*5CkBMBd1dEvRQcFxSdsRjw.png" data-width="611" data-height="120" src="https://cdn-images-1.medium.com/max/800/1*5CkBMBd1dEvRQcFxSdsRjw.png"></div></figure><p name="0aea" id="0aea" class="graf graf--p graf-after--figure graf--trailing">Here is the Code for Server and Client <a href="https://github.com/alexcpn/grpc-expose-web/" data-href="https://github.com/alexcpn/grpc-expose-web/" class="markup--anchor markup--p-anchor" rel="nofollow noopener noopener noopener" target="_blank">https://github.com/alexcpn/grpc-expose-web/</a></p></div></div></section><section name="ac26" class="section section--body section--last"><div class="section-divider"><hr class="section-divider"></div><div class="section-content"><div class="section-inner sectionLayout--insetColumn"><p name="498f" id="498f" class="graf graf--p graf--leading">Now let us explore Option 2 with grpc-web. For this we will re use the same proto; we will change the server so that it exposes normal HTTP/2 like any other GRPC server in C++, Java etc</p><pre name="207f" id="207f" class="graf graf--pre graf-after--p">package main</pre><pre name="e80b" id="e80b" class="graf graf--pre graf-after--pre">import (<br> &quot;log&quot;<br> &quot;net&quot;<br> pb &quot;test_proto/proto&quot;</pre><pre name="059c" id="059c" class="graf graf--pre graf-after--pre">&quot;google.golang.org/grpc&quot;<br> &quot;google.golang.org/grpc/reflection&quot;</pre><pre name="afc2" id="afc2" class="graf graf--pre graf-after--pre">&quot;golang.org/x/net/context&quot;<br>)</pre><pre name="76d9" id="76d9" class="graf graf--pre graf-after--pre">const port = &quot;:7001&quot;</pre><pre name="4d72" id="4d72" class="graf graf--pre graf-after--pre">type server struct{}</pre><pre name="1af3" id="1af3" class="graf graf--pre graf-after--pre">func (s *server) Echo(ctx context.Context, in *pb.StringMessage) (*pb.StringMessage, error) {<br> log.Println(&quot;Got a request&quot;)<br> return &amp;pb.StringMessage{Value: &quot;Hello From a GRPC Method (GRPC WEB Go Server Served) &quot; + in.Value}, nil<br>}</pre><pre name="e15d" id="e15d" class="graf graf--pre graf-after--pre">func main() {</pre><pre name="984b" id="984b" class="graf graf--pre graf-after--pre">log.Println(&quot;Hello Go GRPC&quot;)<br> lis, err := net.Listen(&quot;tcp&quot;, port)<br> if err != nil {<br>  log.Fatalf(&quot;failed to listen: %v&quot;, err)<br> }<br> s := grpc.NewServer()<br> pb.RegisterYourServiceServer(s, &amp;server{})<br> reflection.Register(s)<br> if err := s.Serve(lis); err != nil {<br>  log.Fatalf(&quot;failed to serve: %v&quot;, err)<br> }</pre><p name="d0e4" id="d0e4" class="graf graf--p graf-after--pre">Now if we invoke the client, we will get an error as it cannot directly query the HTTP/2 server</p><pre name="196b" id="196b" class="graf graf--pre graf-after--p">fetch.js:18 OPTIONS <a href="http://localhost:8001/example.YourService/Echo" data-href="http://localhost:8001/example.YourService/Echo" class="markup--anchor markup--pre-anchor" target="_blank">http://localhost:8001/example.YourService/Echo</a> net::ERR_CONNECTION_REFUSED</pre><p name="48d3" id="48d3" class="graf graf--p graf-after--pre">We can use the <a href="https://github.com/improbable-eng/grpc-web/tree/master/go/grpcwebproxy" data-href="https://github.com/improbable-eng/grpc-web/tree/master/go/grpcwebproxy" class="markup--anchor markup--p-anchor" rel="noopener" target="_blank">grpc-web-proxy</a> for this. You need Go version &gt; = 1.7 for the above</p><pre name="ed86" id="ed86" class="graf graf--pre graf-after--p">:~/go-path/src/test_proto$ go version<br>go version go1.8.3 linux/amd64<br> go get -u github.com/improbable-eng/grpc-web/go/grpcwebproxy</pre><p name="4007" id="4007" class="graf graf--p graf-after--pre">Start the GRPC Go server as before</p><pre name="3f6b" id="3f6b" class="graf graf--pre graf-after--p">go run test_server.go<br>2017/06/08 19:54:15 Hello Go GRPC<br>2017/06/08 19:59:58 Got a request</pre><p name="6c6e" id="6c6e" class="graf graf--p graf-after--pre">Run the grpc-proxy in another terminal;</p><p name="b5e6" id="b5e6" class="graf graf--p graf-after--p">Note — this grpcwebproxy is a simple project and has a bug that it is not working without TLS; I downloaded the source and commented out the check and build it a bit to make it work.</p><pre name="8438" id="8438" class="graf graf--pre graf-after--p">:~/go-path/src$ ./grpcwebproxy  --backend_addr=localhost:7001 --backend_tls=true<br>INFO[0000] listening for http_tls on: [::]:8443<br>INFO[0000] listening for http on: [::]:8080<br>INFO[0264] finished streaming call                       grpc.code=OK grpc.method=Echo grpc.service=example.YourService grpc.time_ms=1 span.kind=server system=grpc</pre><p name="17db" id="17db" class="graf graf--p graf-after--pre">And in the client TS changed to port to 8080 which the proxy is listening on and regenerated the bundle.js using gulp</p><pre name="1cb8" id="1cb8" class="graf graf--pre graf-after--p">grpc.invoke(YourService.Echo ,{<br>        request :stringMessage,<br>        //host : &quot;<a href="http://localhost:8001" data-href="http://localhost:8001" class="markup--anchor markup--pre-anchor" rel="nofollow" target="_blank">http://localhost:8001</a>&quot;,<br>        host: &quot;<a href="http://localhost:8080" data-href="http://localhost:8080" class="markup--anchor markup--pre-anchor" rel="nofollow" target="_blank">http://localhost:8080</a>&quot;,</pre><pre name="bce5" id="bce5" class="graf graf--pre graf-after--pre">Echo.onHeaders BrowserHeaders {keyValueMap: Object}<br>grpc_client.ts:20 Echo.onMessage Object {value: &quot;Hello From a GRPC Method (GRPC WEB Go Server Served) hello&quot;}<br>grpc_client.ts:25 Echo.onEnd 0 undefined</pre><figure name="4c4e" id="4c4e" class="graf graf--figure graf-after--pre graf--trailing"><div class="aspectRatioPlaceholder"><img class="graf-image" data-image-id="1*5CkBMBd1dEvRQcFxSdsRjw.png" src="https://cdn-images-1.medium.com/max/800/1*5CkBMBd1dEvRQcFxSdsRjw.png"></div></figure></div></div></section>
</section>
<footer><p>By <a href="https://medium.com/@alexcpn" class="p-author h-card">Alex Punnen</a> on <a href="https://medium.com/p/a95f0d3e5467"><time class="dt-published" datetime="2017-12-22T18:08:22.825Z">December 22, 2017</time></a>.</p><p><a href="https://medium.com/@alexcpn/grpc-web-interface-a95f0d3e5467" class="p-canonical">Canonical link</a></p><p>Exported from <a href="https://medium.com">Medium</a> on August 22, 2019.</p></footer></article></body></html>