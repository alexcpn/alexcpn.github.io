<!DOCTYPE html><html><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"><title>Search for a small container image for Java 12 Microservices</title><style>
      * {
        font-family: Georgia, Cambria, "Times New Roman", Times, serif;
      }
      html, body {
        margin: 0;
        padding: 0;
      }
      h1 {
        font-size: 50px;
        margin-bottom: 17px;
        color: #333;
      }
      h2 {
        font-size: 24px;
        line-height: 1.6;
        margin: 30px 0 0 0;
        margin-bottom: 18px;
        margin-top: 33px;
        color: #333;
      }
      h3 {
        font-size: 30px;
        margin: 10px 0 20px 0;
        color: #333;
      }
      header {
        width: 640px;
        margin: auto;
      }
      section {
        width: 640px;
        margin: auto;
      }
      section p {
        margin-bottom: 27px;
        font-size: 20px;
        line-height: 1.6;
        color: #333;
      }
      section img {
        max-width: 640px;
      }
      footer {
        padding: 0 20px;
        margin: 50px 0;
        text-align: center;
        font-size: 12px;
      }
      .aspectRatioPlaceholder {
        max-width: auto !important;
        max-height: auto !important;
      }
      .aspectRatioPlaceholder-fill {
        padding-bottom: 0 !important;
      }
      header,
      section[data-field=subtitle],
      section[data-field=description] {
        display: none;
      }
      </style></head><body><article class="h-entry">
<header>
<h1 class="p-name">Search for a small container image for Java 12 Microservices</h1>
</header>
<section data-field="subtitle" class="p-summary">
Java 12 is GA from March 2019. Java 12 does not support Alpine Linux
</section>
<section data-field="body" class="e-content">
<section name="6609" class="section section--body section--first section--last"><div class="section-divider"><hr class="section-divider"></div><div class="section-content"><div class="section-inner sectionLayout--insetColumn"><h3 name="7a7f" id="7a7f" class="graf graf--h3 graf--leading graf--title">Search for a small container image for Java 12 Micro-services</h3><h4 name="cfd4" id="cfd4" class="graf graf--h4 graf-after--h3 graf--subtitle"><a href="https://openjdk.java.net/projects/jdk/12/" data-href="https://openjdk.java.net/projects/jdk/12/" class="markup--anchor markup--h4-anchor" rel="noopener" target="_blank">Java 12</a> is GA from March 2019. Java 12 does not support Alpine Linux</h4><p name="522c" id="522c" class="graf graf--p graf-after--h4">Java 12 does not support Alpine Linux. You can see the message below in the JDK 12 release page.</p><blockquote name="f4d7" id="f4d7" class="graf graf--blockquote graf-after--p">The Alpine Linux build previously available on this page was removed as of JDK 12 GA. It’s not production-ready because it hasn’t been tested thoroughly enough to be considered a GA build. Please use the <a href="https://jdk.java.net/13/" data-href="https://jdk.java.net/13/" class="markup--anchor markup--blockquote-anchor" rel="noopener" target="_blank">early-access JDK 13</a> Alpine Linux build in its place — <a href="https://jdk.java.net/12/" data-href="https://jdk.java.net/12/" class="markup--anchor markup--blockquote-anchor" rel="noopener" target="_blank">https://jdk.java.net/12/</a></blockquote><p name="38e8" id="38e8" class="graf graf--p graf-after--blockquote">Strange, this was the same message for Java 11 and we were waiting for Java 12 release to solve this and to upgrade.</p><blockquote name="55f4" id="55f4" class="graf graf--blockquote graf-after--p">The Alpine Linux build previously available on this page was removed as of JDK 11 GA. It’s not production-ready because it hasn’t been tested thoroughly enough to be considered a GA build. Please use the <a href="https://jdk.java.net/12/" data-href="https://jdk.java.net/12/" class="markup--anchor markup--blockquote-anchor" rel="noopener" target="_blank">early-access JDK 12</a> Alpine Linux build in its place. <a href="https://jdk.java.net/11/" data-href="https://jdk.java.net/11/" class="markup--anchor markup--blockquote-anchor" rel="noopener" target="_blank">https://jdk.java.net/<strong class="markup--strong markup--blockquote-strong">11</strong>/</a></blockquote><p name="e42e" id="e42e" class="graf graf--p graf-after--blockquote">Hopefully, in Java 13 we may have the full support for Alpine Linux. But waiting another six months is no more practical. So we need to find another way to reduce the container image size.</p><h4 name="de2e" id="de2e" class="graf graf--h4 graf-after--p"><strong class="markup--strong markup--h4-strong">First — Why Alpine Linux as Docker Image base for Java/other languages?</strong></h4><ol class="postList"><li name="457e" id="457e" class="graf graf--li graf-after--h4">Small Image Size</li><li name="b5f9" id="b5f9" class="graf graf--li graf-after--li">Small Image Size == Less extra packages == Smaller Attack Surface/Lesser warnings from Docker Image Scanners</li></ol><p name="a0d2" id="a0d2" class="graf graf--p graf-after--li">Java 8 was the last release that supported Alpine — this is the reference size</p><pre name="2277" id="2277" class="graf graf--pre graf-after--p">openjdk       8u201-alpine    88d1c219f815     <strong class="markup--strong markup--pre-strong">105MB</strong></pre><p name="d412" id="d412" class="graf graf--p graf-after--pre">Let us see how the alternate JDK 12 versions which is smaller than oracles container image fare, relative to the above.</p><pre name="4aa1" id="4aa1" class="graf graf--pre graf-after--p">adoptopenjdk/openjdk12   x86_64-alpine-jre-12.33    5c3c5120d8d0   <strong class="markup--strong markup--pre-strong">155MB</strong><br>openjdk                  12-oraclelinux7            b1fc416d936f   <strong class="markup--strong markup--pre-strong">470MB</strong></pre><p name="71e7" id="71e7" class="graf graf--p graf-after--pre">The Open-sourced Oracle (Opensource and Oracle sound odd right?. However they release openjdk binaries) weights in at <strong class="markup--strong markup--p-strong">470 MB. Too heavy!</strong></p><p name="c6b5" id="c6b5" class="graf graf--p graf-after--p">The other option we may have is the Java 12 version of Googles slim/’<strong class="markup--strong markup--p-strong">distroless</strong>’ images. The Java 11 version of this weighs in at 194 MB <strong class="markup--strong markup--p-strong">and more than size it may have lesser attack surface; the othe option is the </strong>libc ported version of Alpine Linux.</p><pre name="692c" id="692c" class="graf graf--pre graf-after--p">gcr.io/distroless/java e9c8abbdb7df        49 years ago        194MB</pre><h4 name="3d90" id="3d90" class="graf graf--h4 graf-after--pre">Can I continue with Java 8 or even Java 11 ?</h4><p name="6e0f" id="6e0f" class="graf graf--p graf-after--h4"><strong class="markup--strong markup--p-strong">Yes, you can, but chances are your security architect is not going to let you. </strong>It seems Oracle will provide updates to the latest version of Java. That is Java 12.</p><p name="eee5" id="eee5" class="graf graf--p graf-after--p"><strong class="markup--strong markup--p-strong">Reason 1</strong>: <a href="https://blogs.oracle.com/java-platform-group/extension-of-oracle-java-se-8-public-updates-and-java-web-start-support" data-href="https://blogs.oracle.com/java-platform-group/extension-of-oracle-java-se-8-public-updates-and-java-web-start-support" class="markup--anchor markup--p-anchor" rel="noopener" target="_blank"><em class="markup--em markup--p-em">Public updates of JDK 8 will end in January of 2019</em></a><em class="markup--em markup--p-em">.</em></p><p name="1096" id="1096" class="graf graf--p graf-after--p"><strong class="markup--strong markup--p-strong"><em class="markup--em markup--p-em">Reason 2</em></strong><em class="markup--em markup--p-em">: Security patches and bug fixes will only be </em><a href="https://youtu.be/HqxZFoY_snQ?t=763" data-href="https://youtu.be/HqxZFoY_snQ?t=763" class="markup--anchor markup--p-anchor" rel="noopener" target="_blank"><em class="markup--em markup--p-em">contributed in source form to the latest version of the OpenJDK</em></a><em class="markup--em markup--p-em">. Oracle will not contribute back-ported updates to older versions of OpenJDK. Oracle’s approach is that this work can be undertaken by the broader Java community if there is a demand for it</em></p><p name="06a0" id="06a0" class="graf graf--p graf-after--p">Ref — <a href="https://www.azul.com/eliminating-java-update-confusion/" data-href="https://www.azul.com/eliminating-java-update-confusion/" class="markup--anchor markup--p-anchor" rel="noopener" target="_blank">https://www.azul.com/eliminating-java-update-confusion/</a> + similar blogs from Azul ( which are informative + plug to make you purchase from Azul — <a href="https://www.azul.com/products/zulu-enterprise/" data-href="https://www.azul.com/products/zulu-enterprise/" class="markup--anchor markup--p-anchor" rel="noopener" target="_blank">https://www.azul.com/products/zulu-enterprise/</a> )</p><p name="ea6a" id="ea6a" class="graf graf--p graf-after--p">Java 8 is dated. I see new GC announced in Java 12. Plus I guess many more. Have been a Java developer for many years. But I guess I will never select Java for a new project or micro-service (and that was my view for about 2 years now). These strict licensing from Oracle and lack of updates etc will drive more people to better languages like Go lang (which is climbing up the <a href="https://www.tiobe.com/tiobe-index/" data-href="https://www.tiobe.com/tiobe-index/" class="markup--anchor markup--p-anchor" rel="noopener" target="_blank">Tiobe index</a> — pretty impressive for a new language to be in top 20, especially one that is not that simple in its syntax)</p><h4 name="0e18" id="0e18" class="graf graf--h4 graf-after--p">So what are the options now to move to OpenJDK 1 ?</h4><p name="b31f" id="b31f" class="graf graf--p graf-after--h4">If you are wondering how Alpine Linux different from other Linux ; basically, it used <strong class="markup--strong markup--p-strong"><em class="markup--em markup--p-em">musl</em></strong> whereas most of the other common distro uses <strong class="markup--strong markup--p-strong"><em class="markup--em markup--p-em">libc</em></strong></p><h4 name="0acc" id="0acc" class="graf graf--h4 graf-after--p"><strong class="markup--strong markup--h4-strong">Option 1 — Forget about the size; Use OpenJDK 12</strong></h4><p name="0d57" id="0d57" class="graf graf--p graf-after--h4">You can see the tags here -<a href="https://docs.docker.com/samples/library/openjdk/" data-href="https://docs.docker.com/samples/library/openjdk/" class="markup--anchor markup--p-anchor" rel="nofollow noopener" target="_blank">https://docs.docker.com/samples/library/openjdk/</a></p><p name="e282" id="e282" class="graf graf--p graf-after--p">Example tag — <strong class="markup--strong markup--p-strong">12-jdk-oraclelinux7</strong> — (There is no <a href="https://github.com/docker-library/openjdk/tree/aea0404de13a28d0dedb511f19a69e71efee512b/12" data-href="https://github.com/docker-library/openjdk/tree/aea0404de13a28d0dedb511f19a69e71efee512b/12" class="markup--anchor markup--p-anchor" rel="noopener" target="_blank">JRE folder </a>)<br><a href="https://github.com/docker-library/openjdk/blob/aea0404de13a28d0dedb511f19a69e71efee512b/12/jdk/oracle/Dockerfile" data-href="https://github.com/docker-library/openjdk/blob/aea0404de13a28d0dedb511f19a69e71efee512b/12/jdk/oracle/Dockerfile" class="markup--anchor markup--p-anchor" rel="noopener" target="_blank">Dockerfile</a></p><pre name="d3e9" id="d3e9" class="graf graf--pre graf-after--p">Docker image</pre><pre name="1d6d" id="1d6d" class="graf graf--pre graf-after--pre">openjdk  12-oraclelinux7  b1fc416d936f  10 days ago         <strong class="markup--strong markup--pre-strong">470MB</strong></pre><pre name="f5c0" id="f5c0" class="graf graf--pre graf-after--pre">#Inside the container <br>bash-4.2# java -version<br>openjdk version &quot;12&quot; 2019-03-19<br>OpenJDK Runtime Environment (build 12+33)<br>OpenJDK 64-Bit Server VM (build 12+33, mixed mode, sharing)</pre><h4 name="004e" id="004e" class="graf graf--h4 graf-after--pre"><strong class="markup--strong markup--h4-strong">Option 2 — Use Alpine Linux as a base (and glibc port for Alpine Linux)</strong></h4><p name="4e64" id="4e64" class="graf graf--p graf-after--h4">You can see the tags here -<a href="https://hub.docker.com/r/adoptopenjdk/openjdk12" data-href="https://hub.docker.com/r/adoptopenjdk/openjdk12" class="markup--anchor markup--p-anchor" rel="nofollow noopener" target="_blank">https://hub.docker.com/r/adoptopenjdk/openjdk12</a></p><p name="0365" id="0365" class="graf graf--p graf-after--p">Example tag <strong class="markup--strong markup--p-strong">x86_64-alpine-jre-12.33 — </strong><a href="https://github.com/AdoptOpenJDK/openjdk-docker/blob/master/12/jre/alpine/Dockerfile.hotspot.releases.full" data-href="https://github.com/AdoptOpenJDK/openjdk-docker/blob/master/12/jre/alpine/Dockerfile.hotspot.releases.full" class="markup--anchor markup--p-anchor" rel="noopener" target="_blank">Docker file</a>.</p><p name="ea1d" id="ea1d" class="graf graf--p graf-after--p">(You can see the GLIBC package provided by @sgerrand used here)</p><pre name="5c5a" id="5c5a" class="graf graf--pre graf-after--p">RUN apk --update add --no-cache --virtual .build-deps curl binutils \    &amp;&amp; GLIBC_VER=&quot;2.29-r0&quot; \    &amp;&amp; ALPINE_GLIBC_REPO=&quot;https://github.com/sgerrand/alpine-pkg-glibc/releases/download&quot; \</pre><p name="c528" id="c528" class="graf graf--p graf-after--pre">The image size is still pretty less <strong class="markup--strong markup--p-strong">155 MB</strong></p><pre name="ed1f" id="ed1f" class="graf graf--pre graf-after--p">Docker image <br>adoptopenjdk/openjdk12   x86_64-alpine-jre-12.33    5c3c5120d8d0   37 hours ago    <strong class="markup--strong markup--pre-strong">155MB<br></strong># Inside the container<br>docker run -it --rm adoptopenjdk_alpine:12 /bin/ash<br>/ # java -version<br>Picked up JAVA_TOOL_OPTIONS: <br>openjdk version &quot;12&quot; 2019-03-19<br>OpenJDK Runtime Environment AdoptOpenJDK (build 12+33)<br>OpenJDK 64-Bit Server VM AdoptOpenJDK (build 12+33, mixed mode, sharing)</pre><h4 name="af08" id="af08" class="graf graf--h4 graf-after--pre"><strong class="markup--strong markup--h4-strong">Option 3 -Use Googles ‘Distroless’ option (when there is an image for Java 12)</strong></h4><p name="19f8" id="19f8" class="graf graf--p graf-after--h4">This is basically a stripped down linux base <a href="https://github.com/GoogleContainerTools/distroless/tree/master/base" data-href="https://github.com/GoogleContainerTools/distroless/tree/master/base" class="markup--anchor markup--p-anchor" rel="nofollow noopener" target="_blank">https://github.com/G<em class="markup--em markup--p-em">oogleContainerTools/distroless/tree/master/base</em></a></p><pre name="3651" id="3651" class="graf graf--pre graf-after--p"><em class="markup--em markup--pre-em">This image contains a minimal Linux, glibc-based system. It is intended for use directly by &quot;mostly-statically compiled&quot; languages like Go, Rust or D.</em></pre><p name="8f31" id="8f31" class="graf graf--p graf-after--pre">Plus the Openjdk parts</p><div name="6a43" id="6a43" class="graf graf--mixtapeEmbed graf-after--p"><a href="https://github.com/GoogleContainerTools/distroless/blob/master/java/README.md" data-href="https://github.com/GoogleContainerTools/distroless/blob/master/java/README.md" class="markup--anchor markup--mixtapeEmbed-anchor" title="https://github.com/GoogleContainerTools/distroless/blob/master/java/README.md"><strong class="markup--strong markup--mixtapeEmbed-strong">GoogleContainerTools/distroless</strong><br><em class="markup--em markup--mixtapeEmbed-em">🥑 Language focused docker images, minus the operating system. - GoogleContainerTools/distroless</em>github.com</a><a href="https://github.com/GoogleContainerTools/distroless/blob/master/java/README.md" class="js-mixtapeImage mixtapeImage u-ignoreBlock" data-media-id="bcbf696fbd96fe6369d1ad8a75177c84" data-thumbnail-img-id="0*jkpxkiVQpLLwVmsb" style="background-image: url(https://cdn-images-1.medium.com/fit/c/160/160/0*jkpxkiVQpLLwVmsb);"></a></div><p name="5d59" id="5d59" class="graf graf--p graf-after--mixtapeEmbed">I took the Java 11 version and it is slightly bigger in size than the Alpine Linux part. But need to run Clair or security scan to check if the packages installed are more secure than the AdoptJDK based container (when Java 12 arrives)</p><pre name="b1a7" id="b1a7" class="graf graf--pre graf-after--p">myapp_openjdk_distroless  latest  80efb4be1c22  15 minutes ago      <strong class="markup--strong markup--pre-strong">194MB<br></strong>#Docker file<strong class="markup--strong markup--pre-strong"><br>FROM gcr.io/distroless/java:11</strong></pre><pre name="29dd" id="29dd" class="graf graf--pre graf-after--pre">COPY target/daas-testapp-1.0-SNAPSHOT.jar .</pre><pre name="60b3" id="60b3" class="graf graf--pre graf-after--pre">CMD [&quot;daas-testapp-1.0-SNAPSHOT.jar&quot;]</pre><h4 name="86d5" id="86d5" class="graf graf--h4 graf-after--pre">References</h4><div name="3467" id="3467" class="graf graf--mixtapeEmbed graf-after--h4"><a href="http://blog.gilliard.lol/2018/11/05/alpine-jdk11-images.html" data-href="http://blog.gilliard.lol/2018/11/05/alpine-jdk11-images.html" class="markup--anchor markup--mixtapeEmbed-anchor" title="http://blog.gilliard.lol/2018/11/05/alpine-jdk11-images.html"><strong class="markup--strong markup--mixtapeEmbed-strong">Java 11 in Alpine Linux containers</strong><br><em class="markup--em markup--mixtapeEmbed-em">Now that JDK 11 is fully released with a raft of excellent new features, many developers are looking to use it in…</em>blog.gilliard.lol</a><a href="http://blog.gilliard.lol/2018/11/05/alpine-jdk11-images.html" class="js-mixtapeImage mixtapeImage mixtapeImage--empty u-ignoreBlock" data-media-id="3d58afa1a0b890b1a016eb067c470a74"></a></div><p name="06bb" id="06bb" class="graf graf--p graf-after--mixtapeEmbed"><strong class="markup--strong markup--p-strong"><em class="markup--em markup--p-em">Side note</em></strong></p><p name="7ec3" id="7ec3" class="graf graf--p graf-after--p">If you are into Java then you should maybe check JIB project out. It sounds cool. I have not used it</p><div name="e5de" id="e5de" class="graf graf--mixtapeEmbed graf-after--p graf--trailing"><a href="https://cloud.google.com/blog/products/application-development/jib-1-0-0-is-ga-building-java-docker-images-has-never-been-easier" data-href="https://cloud.google.com/blog/products/application-development/jib-1-0-0-is-ga-building-java-docker-images-has-never-been-easier" class="markup--anchor markup--mixtapeEmbed-anchor" title="https://cloud.google.com/blog/products/application-development/jib-1-0-0-is-ga-building-java-docker-images-has-never-been-easier"><strong class="markup--strong markup--mixtapeEmbed-strong">Jib 1.0.0 is GA-building Java Docker images has never been easier | Google Cloud Blog</strong><br><em class="markup--em markup--mixtapeEmbed-em">For more details, see the Jib Gradle Quickstart. Get started today We want everyone to use Jib to simplify and…</em>cloud.google.com</a><a href="https://cloud.google.com/blog/products/application-development/jib-1-0-0-is-ga-building-java-docker-images-has-never-been-easier" class="js-mixtapeImage mixtapeImage u-ignoreBlock" data-media-id="783886be65646866e2519c12d10fa1a6" data-thumbnail-img-id="0*nKMjWkzw6VBQu7Zh" style="background-image: url(https://cdn-images-1.medium.com/fit/c/160/160/0*nKMjWkzw6VBQu7Zh);"></a></div></div></div></section>
</section>
<footer><p>By <a href="https://medium.com/@alexcpn" class="p-author h-card">Alex Punnen</a> on <a href="https://medium.com/p/fcf62ca7d7d7"><time class="dt-published" datetime="2019-04-09T08:38:02.827Z">April 9, 2019</time></a>.</p><p><a href="https://medium.com/@alexcpn/search-for-a-small-container-image-for-java-12-microservices-fcf62ca7d7d7" class="p-canonical">Canonical link</a></p><p>Exported from <a href="https://medium.com">Medium</a> on August 22, 2019.</p></footer></article></body></html>